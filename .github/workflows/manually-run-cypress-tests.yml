name: Manually run E2E Cypress tests # name of my workflow

# event that triggers the workflow
on:
  [push]
  # workflow_dispatch: # Trigger the workflow manually

permissions:
  contents: write
  pull-requests: write

# For each job, I'll get a Virtual Machine with the environment
# specified by 'runs-on', that other jobs won't be able to access it
jobs:
  cypress-run:
    runs-on: ubuntu-latest
    #strategy:
    #  matrix:
    #    browser: [chrome, firefox, edge] # run tests in all these browsers
    # small sub-tasks, where we can run commands, setup tasks or actions
    steps:
      # Clone the repo
      - name: Check out the remote source code
        uses: actions/checkout@v4
        # Take the project's npm package manager lock file,
        # install dependencies and cache them for future use,
        # run Cypress end-to-end tests with the built-in Electron browser
        # and provide a test summary after completion
      - name: Run the E2E tests
        uses: cypress-io/github-action@v6.1.0
        continue-on-error: true # continue running other workflows even if tests fail

      # Create a public folder to hold the HTML report
      # Videos are copied to the public folder
      - name: Copy test execution videos
        run: |
          mkdir public
          cp -r cypress/videos public/videos

      # Merge all the generated JSON reports
      - name: Merge test results into one
        run: npm run report:merge

      # Generate an HTML report from the merged JSON report
      - name: Generate HTML report
        run: npm run report:generate

      # Publish the generated HTML report
      - name: Deploy report page
        uses: peaceiris/actions-gh-pages@v4.0.0
        with:
          GITHUB_TOKEN: ${{ github.token }}
          publish_dir: ./public
          user_name: 'github-actions[bot]'
          user_email: 'github-actions[bot]@users.noreply.github.com'
